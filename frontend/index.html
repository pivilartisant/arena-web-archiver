<!DOCTYPE html>
<html>
    <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width" />
    <title>Are.na Archiver</title>
    <link rel="stylesheet" href="/static/styles/style.css">
    <link rel="icon" type="image/x-icon" href="/static/assets/favicon.gif">
  </head>
<body>
  <fieldset>
    <legend>Are.na Selfhosted Web Archiver</legend>
<form 
    id="archive-form"
    hx-post="/archive/"
    hx-target="#response"
    hx-indicator=".htmx-indicator"
    hx-on::after-request="if(event.detail.successful) this.reset()"
    hx-on::before-request="document.getElementById('response').innerHTML = ''"

    hx-on:htmx:response-error="
        if(event.detail.xhr.status === 403){
            document.getElementById('response').innerText = 'Forbidden URL (requested website is blocking the archival process)';
        } else if(event.detail.xhr.status === 501){
            document.getElementById('response').innerText = 'ERROR: Invalid URL';
        } else {
           document.getElementById('response').innerText = 'Internal Server Error';
        }
    "

>
<div>></div>
  <input  type="text" name="block_url" placeholder="Are.na block url"/>
  <input  type="text" name="warc_file_name" placeholder="Warc filename"/>
  <input class="radio-option"  type="radio" name="archive_method" value="mirror"> Mirror
  <input class="radio-option" type="radio" name="archive_method" value="snapshot" checked> Snapshot

  <button 
    type="submit"
  >
    Archive
  </button>
</form>

</fieldset>
<img class="htmx-indicator" src="/static/assets/loader.gif">
<fieldset>
  <legend>Archive Status</legend>
<div id="response">
  N/A
</div>
</fieldset>
<hr>
<footer>
  <ul>
    <li>
     <a href="/docs" target="_blank">Docs</a>
    </li>
    <li>
     <a href="https://github.com/pivilartisant/arena-web-archiver" target="_blank">Github</a>
    </li>
  </ul>
</footer>
</body>
<script src="https://cdn.jsdelivr.net/npm/htmx.org@2.0.6/dist/htmx.min.js"></script>
<script>
console.log("Made wih <3 by https://github.com/pivilartisant")
document.body.addEventListener('htmx:afterRequest', (evt) => {
        const detail = evt.detail.xhr.response;
        try {
            const data = JSON.parse(detail);
            if (data.html) {
                document.getElementById('response').innerHTML = data.html;
            }
        } catch {}
    });
</script>
</html>