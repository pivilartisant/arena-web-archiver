<!DOCTYPE html>
<html>
    <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width" />
    <title>Are.na Archiver</title>
    <link rel="stylesheet" href="/static/styles/style.css">
    <link rel="icon" type="image/x-icon" href="/static/assets/favicon.gif">
  </head>
<body>
  <fieldset>
    <legend>Are.na Selfhosted Web Archiver</legend>
<form 
    id="archive-form"
    hx-post="/archive/"
    hx-target="#response"
    hx-indicator=".htmx-indicator"
    hx-on::after-request="if(event.detail.successful) this.reset()"
    hx-on::before-request="document.getElementById('response').innerHTML = ''"

    hx-on:htmx:response-error="
        if(event.detail.xhr.status === 403){
            document.getElementById('response').innerText = 'Forbidden URL (requested website is blocking the archival process)';
        } else if(event.detail.xhr.status === 501){
            document.getElementById('response').innerText = 'ERROR: Invalid URL';
        } else {
           document.getElementById('response').innerText = 'Internal Server Error';
        }
    "

>
<div>></div>
  <input  type="text" name="block_url" placeholder="Are.na block url" required/>
  <input  type="text" name="warc_file_name" placeholder="Warc filename"/>
  <input class="radio-option"  type="radio" name="archive_method" value="mirror"> Mirror
  <input class="radio-option" type="radio" name="archive_method" value="snapshot" checked> Snapshot

  <button 
    type="submit"
  >
    Archive
  </button>
</form>

</fieldset>
<img class="htmx-indicator" src="/static/assets/loader.gif">
<fieldset>
  <legend>Archive Status</legend>
<div id="response">
  N/A
</div>
</fieldset>
<hr>
<div>
  Welcome to the Are.na Web Archiver.
</div>
<br>
<div>
  This minimal and selfhosted utiliy for Are.na is built with <a href="https://htmx.org/">HTMX</a>, <a href="https://fastapi.tiangolo.com/">FastAPI</a> and <a href="https://www.gnu.org/software/wget/">WGET</a>.
</div>
<br>
<div>
  Getting started: 
</div>
Save a block to Are.na -> visit this site or use the API to archive a block. See api specs <a href="/docs">here</a>.
<div>
  <br>
<div>
Some Details:
</div>
<ul>
<li>Website archived will be save as HTML and WARC files.</li>
<li>If no WARC filename is given are.na block id will be used.</li>
<li>Archive are saved in the /tmp directory in the project (not the global /tmp in your filesystem).</li>
<li><em>Mirror</em> makes a 1:1 copy of the website. <em>Snapshot</em> only archives a single page.</li>
</ul>

<div>
  Recommendations:
</div>
<ul>
  <li>Use this tool to save oldweb things that may disapear one day.</li>
  <li>It's not super complex or anything, so expect the bare minimum.</li>
  <li>While mirroring some website will create an infinte loop, this error is not handled.</li>
  <li>For large websites and archives, it's probably better to not use this tool.</li>
</ul>
<div>
That's all folks, peace out!
</div>
</div>



</div>
<footer>
  <ul>
    <li>
     <a href="/docs" target="_blank">API</a>
    </li>
    <li>
     <a href="https://github.com/pivilartisant/arena-web-archiver" target="_blank">Github</a>
    </li>
  </ul>
</footer>
</body>
<script src="https://cdn.jsdelivr.net/npm/htmx.org@2.0.6/dist/htmx.min.js"></script>
<script>
console.log("Made wih <3 by https://github.com/pivilartisant")
document.body.addEventListener('htmx:afterRequest', (evt) => {
        const detail = evt.detail.xhr.response;
        try {
            const data = JSON.parse(detail);
            if (data.html) {
                document.getElementById('response').innerHTML = data.html;
            }
        } catch {}
    });
</script>
</html>